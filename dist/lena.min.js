/*! lena.js 2020-07-05 */

var LenaJS={getImage:function(a){var t=document.createElement("canvas");t.width=a.width,t.height=a.height;var n=t.getContext("2d");return n.drawImage(a,0,0),n.getImageData(0,0,a.width,a.height)},printCanvas:function(a,t){a.width=t.width,a.height=t.height,a.getContext("2d").putImageData(t,0,0)},filterImage:function(a,t,n){var r=[this.getImage(n)];return this.printCanvas(a,t.apply(null,r))},redrawCanvas:function(a,t){var n=[(n=a.getContext("2d")).getImageData(0,0,a.width,a.height)];return this.printCanvas(a,t.apply(null,n))},convolution:function(a,t){for(var n=Math.round(Math.sqrt(t.length)),r=Math.floor(n/2),e=a.data,o=a.width,d=a.height,i=document.createElement("canvas").getContext("2d").createImageData(o,d),u=0;u<d;u++)for(var h=0;h<o;h++){for(var c=4*(u*o+h),v=0,l=0,g=0,f=0;f<n;f++)for(var s=0;s<n;s++){var m,p,M=u+f-r,w=h+s-r;0<=M&&M<d&&0<=w&&w<o&&(m=4*(M*o+w),p=t[f*n+s],v+=e[m]*p,l+=e[1+m]*p,g+=e[2+m]*p)}i.data[c]=v,i.data[1+c]=l,i.data[2+c]=g,i.data[3+c]=255}return i},gradient:function(a,t){for(var n=a.data,r=a.width,e=a.height,o=t.data,d=document.createElement("canvas").getContext("2d").createImageData(r,e),i=new Array(n.length).fill(0),u=0;u<e;u++)for(var h=0;h<r;h++){var c=4*(u*r+h);d.data[c]=Math.sqrt(Math.pow(n[c],2)+Math.pow(o[c],2)),d.data[1+c]=Math.sqrt(Math.pow(n[1+c],2)+Math.pow(o[1+c],2)),d.data[2+c]=Math.sqrt(Math.pow(n[2+c],2)+Math.pow(o[2+c],2)),d.data[3+c]=255,i[c]=Math.atan2(o[c],n[c]),i[1+c]=Math.atan2(o[1+c],n[1+c]),i[2+c]=Math.atan2(o[2+c],n[2+c]),i[3+c]=255}return{magnitude:d,direction:i}},histogram:function(a){"use strict";for(var t=this.getImage(a),n=new Array(257).join("0").split(""),r={r:n.map(Number),g:n.map(Number),b:n.map(Number)},e=0;e<t.data.length;e+=4)r.r[t.data[e]]++,r.g[t.data[e+1]]++,r.b[t.data[e+2]]++;return r},nonMaximumSuppression:function(a,t){for(var n=Math.round(Math.sqrt(25)),r=Math.floor(n/2),e=a.data,o=a.width,d=a.height,i=document.createElement("canvas").getContext("2d").createImageData(o,d),u=0;u<d;u++)for(var h=0;h<o;h++){for(var c=4*(u*o+h),v=e[c],l=e[1+c],g=e[2+c],f=0;f<n;f++)for(var s=0;s<n;s++){var m,p,M=u+f-r,w=h+s-r;0<=M&&M<d&&0<=w&&w<o&&(m=4*(M*o+w),p=Math.atan2(M-u,w-h),v=e[m]*Math.abs(Math.cos(t[c]-p))>v?0:v,l=e[1+m]*Math.abs(Math.cos(t[1+c]-p))>l?0:l,g=e[2+m]*Math.abs(Math.cos(t[2+c]-p))>g?0:g)}i.data[c]=2*v,i.data[1+c]=2*l,i.data[2+c]=2*g,i.data[3+c]=255}return i},bigGaussian:function(a){var t=159,n=[2/t,4/t,5/t,4/t,2/t,4/t,9/t,12/t,9/t,4/t,5/t,12/t,15/t,12/t,5/t,4/t,9/t,12/t,9/t,4/t,2/t,4/t,5/t,4/t,2/t];return LenaJS.convolution(a,n)},canny:function(a){a=LenaJS.bigGaussian(a);var t=LenaJS.sobelHorizontal(a),n=LenaJS.sobelVertical(a),r=LenaJS.gradient(t,n),e=LenaJS.laplacian(a);return a=LenaJS.nonMaximumSuppression(e,r.direction),LenaJS.thresholding(a,8)},gaussian:function(a){var t=[1/16,.125,1/16,.125,.25,.125,1/16,.125,1/16];return LenaJS.convolution(a,t)},grayscale:function(a){for(var t=0;t<a.data.length;t+=4){var n=a.data[t],r=a.data[t+1],e=a.data[t+2];a.data[t]=a.data[t+1]=a.data[t+2]=.2126*n+.7152*r+.0722*e}return a},highpass:function(a){return LenaJS.convolution(a,[-1,-1,-1,-1,8,-1,-1,-1,-1])},invert:function(a){for(var t=0;t<a.data.length;t+=4)a.data[t]=255-a.data[t],a.data[t+1]=255-a.data[t+1],a.data[t+2]=255-a.data[t+2];return a},laplacian:function(a){return LenaJS.convolution(a,[0,-1,0,-1,4,-1,0,-1,0])},lowpass3:function(a){var t=1/9,n=[t,t,t,t,t,t,t,t,t];return LenaJS.convolution(a,n)},lowpass5:function(a){var t=.04,n=[t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t];return LenaJS.convolution(a,n)},mirror:function(a){for(var t=[],n=4*a.width,r=0;r<a.height;r++)for(var e=r*n,o=a.width/2,d=0;d<o;d++){var i=4*d,u=i+e,h=n-i-4+e;t[0]=a.data[u],t[1]=a.data[1+u],t[2]=a.data[2+u],t[3]=a.data[3+u],a.data[u]=a.data[h],a.data[1+u]=a.data[1+h],a.data[2+u]=a.data[2+h],a.data[3+u]=a.data[3+h],a.data[h]=t[0],a.data[1+h]=t[1],a.data[2+h]=t[2],a.data[3+h]=t[3]}return a},prewittHorizontal:function(a){var t=[1/3,1/3,1/3,0,0,0,-1/3,-1/3,-1/3];return LenaJS.convolution(a,t)},prewittVertical:function(a){var t=[-1/3,0,1/3,-1/3,0,1/3,-1/3,0,1/3];return LenaJS.convolution(a,t)},red:function(a){for(var t=a.data,n=0;n<t.length;n+=4)t[n]=t[n],t[n+1]=0,t[n+2]=0;return a},green:function(a){for(var t=a.data,n=0;n<t.length;n+=4)t[n]=0,t[n+2]=0;return a},blue:function(a){for(var t=a.data,n=0;n<t.length;n+=4)t[n]=0,t[n+1]=0;return a},roberts:function(a){return LenaJS.convolution(a,[0,0,0,1,-1,0,0,0,0])},saturation:function(a){for(var t=0;t<a.data.length;t+=4)a.data[t]=2.31366*a.data[t]+-1.15596*a.data[t+1]+-.1558*a.data[t+2],a.data[t+1]=-.58634*a.data[t]+1.7440399999999998*a.data[t+1]+-.1558*a.data[t+2],a.data[t+2]=-.58634*a.data[t]+-1.15596*a.data[t+1]+2.7441999999999998*a.data[t+2];return a},sepia:function(a){for(var t=0;t<a.data.length;t+=4){var n=a.data[t],r=a.data[t+1],e=a.data[t+2];a.data[t]=a.data[t+1]=a.data[t+2]=.3*n+.59*r+.11*e,a.data[t]+=40,a.data[t+1]+=20,a.data[t+2]-=20}return a},sharpen:function(a){return LenaJS.convolution(a,[0,-.2,0,-.2,1.8,-.2,0,-.2,0])},sobelHorizontal:function(a){var t=[.25,.5,.25,0,0,0,-.25,-.5,-.25];return a=LenaJS.convolution(a,t)},sobelVertical:function(a){var t=[.25,0,-.25,.5,0,-.5,.25,0,-.25];return a=LenaJS.convolution(a,t)},thresholding:function(a,t){for(var n=0;n<a.data.length;n+=4){var r=.2126*a.data[n]+.7152*a.data[n+1]+.0722*a.data[n+2],e=t||128;a.data[n]=a.data[n+1]=a.data[n+2]=e<r?255:0}return a}};